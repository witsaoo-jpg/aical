<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Scanner V.3</title>
    <style>
        body { font-family: 'Sarabun', sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f0f2f5; }
        .container { background-color: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; }
        .badge { background-color: #ff4757; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; vertical-align: middle; }
        
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        select { background-color: #fff; }

        button { width: 100%; background-color: #007bff; color: white; padding: 14px; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; margin-top: 10px; font-weight: bold; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; }

        #preview { max-width: 100%; margin-top: 15px; border-radius: 8px; display: none; border: 2px dashed #ddd; }
        #result { margin-top: 20px; padding: 20px; background-color: #e3f2fd; border-radius: 8px; white-space: pre-wrap; line-height: 1.6; display: none; }
        .error { color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 8px; margin-top: 15px; display: none; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

<div class="container">
    <h1>Gemini Scan <span class="badge">V.3</span></h1>

    <div class="input-group">
        <label>API Key (‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏∏‡∏ç‡πÅ‡∏à):</label>
        <input type="password" id="apiKey" placeholder="‡∏ß‡∏≤‡∏á API Key ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (AIza...)">
    </div>

    <div class="input-group">
        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏• AI:</label>
        <select id="modelSelect">
            <option value="gemini-1.5-flash">Gemini 1.5 Flash (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</option>
            <option value="gemini-1.5-pro">Gemini 1.5 Pro (‡∏â‡∏•‡∏≤‡∏î‡∏Å‡∏ß‡πà‡∏≤)</option>
            <option value="gemini-1.5-flash-001">Gemini 1.5 Flash (‡∏™‡∏≥‡∏£‡∏≠‡∏á 1)</option>
            <option value="gemini-1.5-flash-latest">Gemini 1.5 Flash (‡∏™‡∏≥‡∏£‡∏≠‡∏á 2)</option>
        </select>
        <small style="color: #666; font-size: 12px;">*‡∏ñ‡πâ‡∏≤‡∏≠‡∏±‡∏ô‡πÅ‡∏£‡∏Å Error ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö</small>
    </div>

    <div class="input-group">
        <label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</label>
        <input type="file" id="imageInput" accept="image/*">
        <img id="preview" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ">
    </div>

    <div class="input-group">
        <label>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:</label>
        <textarea id="prompt" rows="3">‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£ ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á</textarea>
    </div>

    <button id="generateBtn">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>

    <div id="errorBox" class="error"></div>
    <div id="result"></div>
</div>

<script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    const elements = {
        imageInput: document.getElementById('imageInput'),
        preview: document.getElementById('preview'),
        generateBtn: document.getElementById('generateBtn'),
        result: document.getElementById('result'),
        errorBox: document.getElementById('errorBox'),
        apiKey: document.getElementById('apiKey'),
        modelSelect: document.getElementById('modelSelect'),
        prompt: document.getElementById('prompt')
    };

    // ‡∏à‡∏≥ API Key ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢‡πÜ
    if(localStorage.getItem('gemini_api_key')) {
        elements.apiKey.value = localStorage.getItem('gemini_api_key');
    }

    elements.apiKey.addEventListener('change', () => {
        localStorage.setItem('gemini_api_key', elements.apiKey.value);
    });

    elements.imageInput.addEventListener('change', () => {
        const file = elements.imageInput.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                elements.preview.src = e.target.result;
                elements.preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });

    async function fileToGenerativePart(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve({
                inlineData: { data: reader.result.split(',')[1], mimeType: file.type }
            });
            reader.readAsDataURL(file);
        });
    }

    elements.generateBtn.addEventListener('click', async () => {
        const apiKey = elements.apiKey.value.trim();
        const promptText = elements.prompt.value;
        const file = elements.imageInput.files[0];
        const selectedModel = elements.modelSelect.value; // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

        // Reset UI
        elements.errorBox.style.display = 'none';
        elements.result.style.display = 'block';
        elements.result.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•... (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ 5-10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)';
        elements.generateBtn.disabled = true;

        if (!apiKey) {
            showError("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å API Key ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
            return;
        }

        try {
            const genAI = new GoogleGenerativeAI(apiKey);
            
            // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà user ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏ô‡∏π
            const model = genAI.getGenerativeModel({ model: selectedModel });

            let result;
            if (file) {
                const imagePart = await fileToGenerativePart(file);
                result = await model.generateContent([promptText, imagePart]);
            } else {
                result = await model.generateContent(promptText);
            }

            const response = await result.response;
            const text = response.text();
            
            elements.result.innerHTML = `<strong>‚úÖ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (${selectedModel}):</strong><br><br>${text}`;

        } catch (error) {
            console.error(error);
            let msg = error.toString();
            if (msg.includes("404") || msg.includes("not found")) {
                msg = `‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏• "${selectedModel}" \nüëâ ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡πÇ‡∏°‡πÄ‡∏î‡∏• AI" ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏±‡∏ö`;
            } else if (msg.includes("API key")) {
                msg = "‚ùå API Key ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô";
            }
            showError(msg);
        } finally {
            elements.generateBtn.disabled = false;
        }
    });

    function showError(msg) {
        elements.errorBox.style.display = 'block';
        elements.errorBox.innerText = msg;
        elements.result.style.display = 'none';
        elements.generateBtn.disabled = false;
    }
</script>

</body>
</html>
